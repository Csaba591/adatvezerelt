


<!doctype html>
<html lang="hu" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="Dudás Ákos">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.4.0">
    
    
      
        <title>Tranzakciókezelés - BMEVIAUAC01 Adatvezérelt rendszerek</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.fe0cca5b.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a46bcfb3.min.css">
      
      
        
        
        <meta name="theme-color" content="#ef5350">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../extra-material-theme.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="red" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tranzakciokezeles" class="md-skip">
          Kihagyás
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="BMEVIAUAC01 Adatvezérelt rendszerek" class="md-header-nav__button md-logo" aria-label="BMEVIAUAC01 Adatvezérelt rendszerek">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            BMEVIAUAC01 Adatvezérelt rendszerek
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Tranzakciókezelés
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Keresés" placeholder="Keresés" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/bmeviauac01/adatvezerelt/" title="Főoldalra ugrás" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    bmeviauac01/adatvezerelt
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link md-tabs__link--active">
        Adatvezérelt rendszerek
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../db/" class="md-tabs__link">
          Adatbázis
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../jegyzet/architektura/" class="md-tabs__link">
          Jegyzetek
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="BMEVIAUAC01 Adatvezérelt rendszerek" class="md-nav__button md-logo" aria-label="BMEVIAUAC01 Adatvezérelt rendszerek">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    BMEVIAUAC01 Adatvezérelt rendszerek
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/bmeviauac01/adatvezerelt/" title="Főoldalra ugrás" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    bmeviauac01/adatvezerelt
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Adatvezérelt rendszerek" class="md-nav__link">
      Adatvezérelt rendszerek
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Adatbázis
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Adatbázis" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Adatbázis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/" title="Minta adatbázis sémája" class="md-nav__link">
      Minta adatbázis sémája
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/mssql/" title="Microsoft SQL Server használata" class="md-nav__link">
      Microsoft SQL Server használata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/mongodb/" title="MongoDB használata" class="md-nav__link">
      MongoDB használata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/mssql.sql" title="mssql.sql" class="md-nav__link">
      mssql.sql
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/mongo.js" title="mongodb.js" class="md-nav__link">
      mongodb.js
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Jegyzetek
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Jegyzetek" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Jegyzetek
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../jegyzet/architektura/" title="Adatvezérelt rendszerek és a többrétegű (háromrétegű) architektúra" class="md-nav__link">
      Adatvezérelt rendszerek és a többrétegű (háromrétegű) architektúra
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../jegyzet/transactions/" title="Tranzakciókezelés adatbázisokban" class="md-nav__link">
      Tranzakciókezelés adatbázisokban
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../jegyzet/mssql/sql/" title="SQL nyelv, MSSQL platformfüggő SQL utasítások" class="md-nav__link">
      SQL nyelv, MSSQL platformfüggő SQL utasítások
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../jegyzet/mssql/server-side-programming/" title="Microsoft SQL Server programozása" class="md-nav__link">
      Microsoft SQL Server programozása
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../jegyzet/linq/" title="LINQ: Language Integrated Query" class="md-nav__link">
      LINQ: Language Integrated Query
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../jegyzet/mongodb/" title="MongoDB műveletek és a MongoDB .NET Driver" class="md-nav__link">
      MongoDB műveletek és a MongoDB .NET Driver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../jegyzet/dependency-injection/index.md" title="None" class="md-nav__link">
      None
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://github.com/bmeviauac01/rest-webapi-sample" title="REST és WebAPI demó alkalmazás" class="md-nav__link">
      REST és WebAPI demó alkalmazás
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://github.com/bmeviauac01/todoapi-di-sample" title="ASP.NET Core DI demó alkalmazás" class="md-nav__link">
      ASP.NET Core DI demó alkalmazás
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://github.com/bmeviauac01/threelayered-aspnetcore-sample" title="Minta többrétegű webalkalmazás" class="md-nav__link">
      Minta többrétegű webalkalmazás
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#celkituzes" class="md-nav__link">
    Célkitűzés
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elofeltetelek" class="md-nav__link">
    Előfeltételek
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gyakorlat-menete" class="md-nav__link">
    Gyakorlat menete
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-1-adatbazis-letrehozasa-ms-sql-serveren" class="md-nav__link">
    Feladat 1: Adatbázis létrehozása MS SQL Serveren
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-2-parhuzamos-tranzakciok" class="md-nav__link">
    Feladat 2: Párhuzamos tranzakciók
  </a>
  
    <nav class="md-nav" aria-label="Feladat 2: Párhuzamos tranzakciók">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mit-tapasztalt-miert" class="md-nav__link">
    Mit tapasztalt? Miért?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-3-tranzakcio-inditasa-read-committed-izolacios-szint" class="md-nav__link">
    Feladat 3: Tranzakció indítása, read committed izolációs szint
  </a>
  
    <nav class="md-nav" aria-label="Feladat 3: Tranzakció indítása, read committed izolációs szint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mit-tapasztalt-miert_1" class="md-nav__link">
    Mit tapasztalt? Miért?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-4-tranzakcio-megszakitasa-rollback-read-committed-izolacios-szinten" class="md-nav__link">
    Feladat 4: Tranzakció megszakítása (rollback) read committed izolációs szinten
  </a>
  
    <nav class="md-nav" aria-label="Feladat 4: Tranzakció megszakítása (rollback) read committed izolációs szinten">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mit-tapasztalt-miert_2" class="md-nav__link">
    Mit tapasztalt? Miért?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-5-megrendeles-rogzitese-serializable-izolacios-szinten" class="md-nav__link">
    Feladat 5: Megrendelés rögzítése serializable izolációs szinten
  </a>
  
    <nav class="md-nav" aria-label="Feladat 5: Megrendelés rögzítése serializable izolációs szinten">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mit-tapasztalt-miert_3" class="md-nav__link">
    Mit tapasztalt? Miért?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mit-tapasztalt-miert_4" class="md-nav__link">
    Mit tapasztalt? Miért?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-6-megrendeles-rogzitese-read-committed-izolacios-szinten" class="md-nav__link">
    Feladat 6: Megrendelés rögzítése read committed izolációs szinten
  </a>
  
    <nav class="md-nav" aria-label="Feladat 6: Megrendelés rögzítése read committed izolációs szinten">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mit-tapasztalt-miert_5" class="md-nav__link">
    Mit tapasztalt? Miért?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-7-manualis-zarolas" class="md-nav__link">
    Feladat 7: Manuális zárolás
  </a>
  
    <nav class="md-nav" aria-label="Feladat 7: Manuális zárolás">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hova-kell-ezt-a-zarat-elhelyezni-hogyan-nez-ki-igy-a-megrendeles-folyamata" class="md-nav__link">
    Hova kell ezt a zárat elhelyezni? Hogyan néz ki így a megrendelés folyamata?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-8-tabla-szintu-zarolas" class="md-nav__link">
    Feladat 8: Tábla szintű zárolás
  </a>
  
    <nav class="md-nav" aria-label="Feladat 8: Tábla szintű zárolás">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bar-ez-egyszeru-megoldasnak-tunik-gondoljuk-vegig-miert-nem-erdemes-ezt-hasznalni" class="md-nav__link">
    Bár ez egyszerű megoldásnak tűnik, gondoljuk végig, miért nem érdemes ezt használni!
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/bmeviauac01/adatvezerelt/edit/master/docs/gyakorlat/Gyak-Tranzakciok/README.md" title="Oldal szerkesztése" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="tranzakciokezeles">Tranzakciókezelés<a class="headerlink" href="#tranzakciokezeles" title="Permanent link">&para;</a></h1>
<h2 id="celkituzes">Célkitűzés<a class="headerlink" href="#celkituzes" title="Permanent link">&para;</a></h2>
<p>Relációs adatbázisok és a Microsoft SQL Server tranzakciókezelésének megismerése. Serializable izolációs szint gyakorlati használhatóságának korlátai, egyedi adat egymásra hatások szabályozása read committed izolációs szinten.</p>
<h2 id="elofeltetelek">Előfeltételek<a class="headerlink" href="#elofeltetelek" title="Permanent link">&para;</a></h2>
<p>A labor elvégzéséhez szükséges eszközök:</p>
<ul>
<li>Microsoft SQL Server (LocalDB vagy Express edition)</li>
<li>SQL Server Management Studio</li>
<li>Adatbázis létrehozó script: <a href="https://raw.githubusercontent.com/bmeviauac01/gyakorlatok/master/mssql.sql">mssql.sql</a></li>
</ul>
<p>Amit érdemes átnézned:</p>
<ul>
<li>Tranzakciók tulajdonságai, izolációs szintek.</li>
<li><a href="../Adatbazis/mssql-server.md">Microsoft SQL Server használata segédlet</a></li>
</ul>
<h2 id="gyakorlat-menete">Gyakorlat menete<a class="headerlink" href="#gyakorlat-menete" title="Permanent link">&para;</a></h2>
<p>A gyakorlat vezetett. A szoftverekkel történő megismerkedés után a gyakorlatvezető instrukciói alapján együtt kerülnek elvégzésre a feladatok. A tapasztalt viselkedésekre magyarázatot keresünk, és azt a csoport együtt megbeszéli.</p>
<p>A viselkedések magyarázatát röviden összefoglalja az útmutató is. Előbb azonban gondolkodjunk el magunk a kérdéseken!</p>
<h2 id="feladat-1-adatbazis-letrehozasa-ms-sql-serveren">Feladat 1: Adatbázis létrehozása MS SQL Serveren<a class="headerlink" href="#feladat-1-adatbazis-letrehozasa-ms-sql-serveren" title="Permanent link">&para;</a></h2>
<p>Első lépésként szükségünk lesz egy adatbázisra. Az adatbázis tipikusan egy központi kiszolgálón helyezkedik el, de fejlesztés közben sokszor a saját gépünkön fut. Mi ez utóbbi opciót választjuk.</p>
<ol>
<li>
<p>Kapcsolódjon a Microsoft SQL Serverhez SQL Server Management Studio Segítségével. Indítsa el az alkalmazást, és az alábbi adatokkal kapcsolódjon.</p>
</li>
<li>
<p>Server name: <code>(localdb)\mssqllocaldb</code> vagy <code>.\sqlexpress</code></p>
</li>
<li>
<p>Authentication: <code>Windows authentication</code></p>
</li>
<li>
<p>Hozzon létre egy új adatbázist (ha még nem létezik)! Az adatbázis neve legyen a Neptun kódja: <em>Object Explorer</em>-ben Databases-en jobb kattintás, és <em>Create Database</em>.</p>
</li>
<li>
<p>Hozza létre a minta adatbázist az generáló script lefuttatásával. Nyisson egy új <em>Query</em> ablakot, másolja be a script tartalmát, és futtassa le. Ügyeljen az eszköztáron levő legördülő menüben a megfelelő adatbázis kiválasztására.</p>
</li>
</ol>
<p><img alt="Adatbázis kiválasztása" src="images/sql-management-database-dropdown.png" /></p>
<ol>
<li>Ellenőrizze, hogy létrejöttek-e a táblák. Ha a <em>Tables</em> mappa ki volt már nyitva, akkor frissíteni kell.</li>
</ol>
<p><img alt="Adatbázis kiválasztása" src="images/sql-managment-tablak.png" />.</p>
<h2 id="feladat-2-parhuzamos-tranzakciok">Feladat 2: Párhuzamos tranzakciók<a class="headerlink" href="#feladat-2-parhuzamos-tranzakciok" title="Permanent link">&para;</a></h2>
<p>Nyisson két Query ablakot párhuzamos tranzakciók szimulálásához a New Query gomb kétszeri megnyomásával. Érdemes az ablakokat egymás mellé tenni: a Query fül fejlécére jobb egérrel kattintva válasszuk a <em>New Vertical Tab Group</em> opciót:</p>
<p><img alt="Két tranzakció elhelyezése egymás mellé" src="images/sql-management-tab-group.png" /></p>
<p>Használja az alábbi ütemezést a parancsok végrehajtására. A T1 tranzakció a 4-es megrendelés státuszát ellenőrzi, míg a T2 tranzakció
megváltoztatja a státuszt csomagolváról szállítás alattira.</p>
<ol>
<li><strong>T1 tranzakció</strong></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1">-- Listázzuk ki a megrendelés és a hozzá tartozó tételek státuszát</span>
<span class="k">select</span> <span class="n">s1</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">s2</span><span class="p">.</span><span class="n">Name</span>
<span class="k">from</span> <span class="p">[</span><span class="k">Order</span><span class="p">]</span> <span class="n">o</span><span class="p">,</span> <span class="n">OrderItem</span> <span class="n">oi</span><span class="p">,</span> <span class="n">Status</span> <span class="n">s1</span><span class="p">,</span> <span class="n">status</span> <span class="n">s2</span><span class="p">,</span> <span class="n">Product</span> <span class="n">p</span>
<span class="k">where</span> <span class="n">o</span><span class="p">.</span><span class="n">Id</span><span class="o">=</span><span class="n">oi</span><span class="p">.</span><span class="n">OrderID</span>
<span class="k">and</span> <span class="n">o</span><span class="p">.</span><span class="n">ID</span><span class="o">=</span><span class="mi">4</span>
<span class="k">and</span> <span class="n">o</span><span class="p">.</span><span class="n">StatusID</span><span class="o">=</span><span class="n">s1</span><span class="p">.</span><span class="n">ID</span>
<span class="k">and</span> <span class="n">oi</span><span class="p">.</span><span class="n">StatusID</span><span class="o">=</span><span class="n">s2</span><span class="p">.</span><span class="n">ID</span>
<span class="k">and</span> <span class="n">p</span><span class="p">.</span><span class="n">ID</span><span class="o">=</span><span class="n">oi</span><span class="p">.</span><span class="n">ProductID</span>
</code></pre></div>

<blockquote>
<p>Az <code>[Order]</code> tábla nevében azért kell a szögletes zárójel, hogy jelezzük, tábla névről van szó, és nem az <code>order by</code> parancs kezdetéről.</p>
</blockquote>
<ol>
<li><strong>T2 tranzakció</strong></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1">-- Állítsuk át a megrendelés állapotát</span>
<span class="k">update</span> <span class="p">[</span><span class="k">Order</span><span class="p">]</span>
<span class="k">set</span> <span class="n">StatusID</span><span class="o">=</span><span class="mi">4</span>
<span class="k">where</span> <span class="n">ID</span><span class="o">=</span><span class="mi">4</span>
</code></pre></div>

<ol>
<li>
<p><strong>T1 tranzakció</strong>: első lépésben kiadott parancs megismételve</p>
</li>
<li>
<p><strong>T2 tranzakció</strong></p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1">-- Állítsuk át a megrendeléshez tartozó tételek állapotát</span>
<span class="k">update</span> <span class="n">OrderItem</span>
<span class="k">set</span> <span class="n">StatusID</span><span class="o">=</span><span class="mi">4</span>
<span class="k">where</span> <span class="n">OrderID</span><span class="o">=</span><span class="mi">4</span>
</code></pre></div>

<ol>
<li><strong>T1 tranzakció</strong>: első lépésben kiadott parancs megismételve</li>
</ol>
<h5 id="mit-tapasztalt-miert">Mit tapasztalt? Miért?<a class="headerlink" href="#mit-tapasztalt-miert" title="Permanent link">&para;</a></h5>
<details><summary markdown="span">Magyarázat</summary>

> Kezdetben minden tétel "Packaged" státuszban van, ami így konzisztens (nem lehet egy darab tétel "in transit", azaz postázás alatt, ha a megrendelés nincs). Viszont, amint változatunk a megrendelés állapotán, a csomag státusza ellentmondásosnak látszik a tételek státuszával. Az adatbázis **nem** inkonzisztens, mert a belső szabályai (integritási kritériumai) alapján nincs probléma. De üzleti értelemben ellentmondásos a tartalom.
>
> Az SQL Server alapértelmezésben auto commit üzemmódban fut, azaz egy utasítás az egy tranzakció, amit automatikusan lezár. Tehát a probléma, hogy a módosításaink nem egy tranzakciót képeznek.
>
> A helyes viselkedéshez össze kellene fogni a két adatmódosító utasítást egy tranzakcióba.

</details>

<h2 id="feladat-3-tranzakcio-inditasa-read-committed-izolacios-szint">Feladat 3: Tranzakció indítása, <em>read committed</em> izolációs szint<a class="headerlink" href="#feladat-3-tranzakcio-inditasa-read-committed-izolacios-szint" title="Permanent link">&para;</a></h2>
<p>Ismételje meg az előző feladatot úgy, hogy a két adatmódosítás egy tranzakciót képezzen:</p>
<ul>
<li>A <strong>T2 tranzakció</strong> kezdjen egy <code>begin tran</code>, és végződjön egy <code>commit</code> utasítással.</li>
<li>Az adatmódosításnál a státuszt ezúttal 3-asra állítsuk (hogy érdemi változás legyen az adatokban).</li>
</ul>
<h4 id="mit-tapasztalt-miert_1">Mit tapasztalt? Miért?<a class="headerlink" href="#mit-tapasztalt-miert_1" title="Permanent link">&para;</a></h4>
<details><summary markdown="span">Magyarázat</summary>

> Amint elkezdtük a státusz módosítását **T2**-ben, a lekérdező **T1**-es utasítás várni fog. Addig vár, amíg az adatmódosító tranzakció be nem fejeződik. Ez azért van, mert a `select` utasítás olvasási zárat akar elhelyezni, de másik tranzakció éppen módosítja az adott rekordot, így kizáró zárat helyezett el rajta.
>
> Jegyezzük meg, hogy az alap izolációs szint, a *read committed* ezen a platformon azt jelenti, hogy módosítás alatt levő adat nem olvasható. Ez egy implementációs kérdés, az SQL szabvány ezt nem rögzíti. Más adatbázis platform viselkedhet máshogy is (pl. az Oracle Server biztosítja, hogy a rekordok commitált képe mindenképpen olvasható marad). Más izolációs szinten az MSSQL szerver is máshogy viselkedik, a *snapshot* izolációs szint használata esetén a módosítás megkezdése előtti változat olvasható.

</details>

<h2 id="feladat-4-tranzakcio-megszakitasa-rollback-read-committed-izolacios-szinten">Feladat 4: Tranzakció megszakítása (<em>rollback</em>) <em>read committed</em> izolációs szinten<a class="headerlink" href="#feladat-4-tranzakcio-megszakitasa-rollback-read-committed-izolacios-szinten" title="Permanent link">&para;</a></h2>
<p>Kezdjük el lefuttatni az előző parancs sorozatot, a tranzakcióval együtt, de a módosító tranzakciót szakítsuk meg a közepén.</p>
<ol>
<li><strong>T1 tranzakció</strong></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1">-- Listázzuk ki a megrendelés és a hozzá tartozó tételek státuszát</span>
<span class="k">select</span> <span class="n">s1</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">s2</span><span class="p">.</span><span class="n">Name</span>
<span class="k">from</span> <span class="p">[</span><span class="k">Order</span><span class="p">]</span> <span class="n">o</span><span class="p">,</span> <span class="n">OrderItem</span> <span class="n">oi</span><span class="p">,</span> <span class="n">Status</span> <span class="n">s1</span><span class="p">,</span> <span class="n">status</span> <span class="n">s2</span><span class="p">,</span> <span class="n">Product</span> <span class="n">p</span>
<span class="k">where</span> <span class="n">o</span><span class="p">.</span><span class="n">Id</span><span class="o">=</span><span class="n">oi</span><span class="p">.</span><span class="n">OrderID</span>
<span class="k">and</span> <span class="n">o</span><span class="p">.</span><span class="n">ID</span><span class="o">=</span><span class="mi">4</span>
<span class="k">and</span> <span class="n">o</span><span class="p">.</span><span class="n">StatusID</span><span class="o">=</span><span class="n">s1</span><span class="p">.</span><span class="n">ID</span>
<span class="k">and</span> <span class="n">oi</span><span class="p">.</span><span class="n">StatusID</span><span class="o">=</span><span class="n">s2</span><span class="p">.</span><span class="n">ID</span>
<span class="k">and</span> <span class="n">p</span><span class="p">.</span><span class="n">ID</span><span class="o">=</span><span class="n">oi</span><span class="p">.</span><span class="n">ProductID</span>
</code></pre></div>

<ol>
<li><strong>T2 tranzakció</strong></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1">-- Új tranzakciót kezdünk</span>
<span class="k">begin</span> <span class="n">tran</span>

<span class="c1">-- Állítsuk át a megrendelés állapotát</span>
<span class="k">update</span> <span class="p">[</span><span class="k">Order</span><span class="p">]</span>
<span class="k">set</span> <span class="n">StatusID</span><span class="o">=</span><span class="mi">4</span>
<span class="k">where</span> <span class="n">ID</span><span class="o">=</span><span class="mi">4</span>
</code></pre></div>

<ol>
<li>
<p><strong>T1 tranzakció</strong>: első lépésben kiadott parancs megismételve</p>
</li>
<li>
<p><strong>T2 tranzakció</strong></p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1">-- Szakítsuk meg a tranzakciót</span>
<span class="k">rollback</span>
</code></pre></div>

<h4 id="mit-tapasztalt-miert_2">Mit tapasztalt? Miért?<a class="headerlink" href="#mit-tapasztalt-miert_2" title="Permanent link">&para;</a></h4>
<details><summary markdown="span">Magyarázat</summary>

> Az előzőekben tapasztaltakhoz hasonlóan a módosítás megkezdte után az olvasó utasítás várakozásra kényszerült. Amikor megszakítottuk a tranzakciót, akkor érkezett meg az eredmény. Mivel _read committed_ izolációs szinten vagyunk, nem látjuk a módosítás alatt levő tartalmat. Amint a módosító tranzakció befejeződik, akár sikeres `commit`, akár `rollback` miatt, elérhetővé válnak a rekordok.
>
> Vegyük észre, hogy pont elkerültük a piszkos olvasás problémáját. Ha a módosítás futása közben megjelent volna a félkész eredmény, a `rollback` miatt az a tranzakció érvénytelen adattal dolgozna tovább.

</details>

<h2 id="feladat-5-megrendeles-rogzitese-serializable-izolacios-szinten">Feladat 5: Megrendelés rögzítése <em>serializable</em> izolációs szinten<a class="headerlink" href="#feladat-5-megrendeles-rogzitese-serializable-izolacios-szinten" title="Permanent link">&para;</a></h2>
<p>A feladat megkezdése előtt először is szakítsuk meg a félbemaradt tranzakciókat. Mindkét ablakban adjunk ki pár <code>rollback</code> utasítást az esetleg ottmaradt tranzakciók leállításához.</p>
<p>Legyen két párhuzamos tranzakciónk, melyek megrendelést rögzítenek. Egy termékre nem vehetünk fel több megrendelést, mint ami a raktárkészlet. Azért, hogy a tranzakciók egymásra hatását elkülönítsük, kapcsoljunk át <em>serializable</em> izolációs szintre.</p>
<ol>
<li><strong>T1 tranzakció</strong></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">set</span> <span class="n">transaction</span> <span class="k">isolation</span> <span class="k">level</span> <span class="k">serializable</span>
<span class="k">begin</span> <span class="n">tran</span>

<span class="c1">-- Ellenőrizzük, hogy mennyi van raktáron egy termékből</span>
<span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="n">Product</span>
<span class="k">where</span> <span class="n">ID</span><span class="o">=</span><span class="mi">2</span>
</code></pre></div>

<ol>
<li><strong>T2 tranzakció</strong></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">set</span> <span class="n">transaction</span> <span class="k">isolation</span> <span class="k">level</span> <span class="k">serializable</span>
<span class="k">begin</span> <span class="n">tran</span>

<span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="n">Product</span>
<span class="k">where</span> <span class="n">ID</span><span class="o">=</span><span class="mi">2</span>
</code></pre></div>

<ol>
<li><strong>T1 tranzakció</strong></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1">-- Ellenőrizzük, hogy hány, még fel nem dolgozott megrendelés van erre a termékre</span>
<span class="k">select</span> <span class="k">sum</span><span class="p">(</span><span class="n">Amount</span><span class="p">)</span>
<span class="k">from</span> <span class="n">OrderItem</span>
<span class="k">where</span> <span class="n">ProductID</span><span class="o">=</span><span class="mi">2</span>
<span class="k">and</span> <span class="n">StatusID</span><span class="o">=</span><span class="mi">1</span>
</code></pre></div>

<ol>
<li><strong>T2 tranzakció</strong></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">select</span> <span class="k">sum</span><span class="p">(</span><span class="n">Amount</span><span class="p">)</span>
<span class="k">from</span> <span class="n">OrderItem</span>
<span class="k">where</span> <span class="n">ProductID</span><span class="o">=</span><span class="mi">2</span>
<span class="k">and</span> <span class="n">StatusID</span><span class="o">=</span><span class="mi">1</span>
</code></pre></div>

<ol>
<li><strong>T1 tranzakció</strong></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1">-- Mivel teljesíthető a megrendelés, rögzítsük</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">OrderItem</span><span class="p">(</span><span class="n">OrderID</span><span class="p">,</span><span class="n">ProductID</span><span class="p">,</span><span class="n">Amount</span><span class="p">,</span><span class="n">StatusID</span><span class="p">)</span>
<span class="k">values</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<ol>
<li><strong>T2 tranzakció</strong></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">insert</span> <span class="k">into</span> <span class="n">OrderItem</span><span class="p">(</span><span class="n">OrderID</span><span class="p">,</span><span class="n">ProductID</span><span class="p">,</span><span class="n">Amount</span><span class="p">,</span><span class="n">StatusID</span><span class="p">)</span>
<span class="k">values</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<ol>
<li><strong>T1 tranzakció</strong></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">commit</span>
</code></pre></div>

<ol>
<li><strong>T2 tranzakció</strong></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">commit</span>
</code></pre></div>

<h4 id="mit-tapasztalt-miert_3">Mit tapasztalt? Miért?<a class="headerlink" href="#mit-tapasztalt-miert_3" title="Permanent link">&para;</a></h4>
<details><summary markdown="span">Magyarázat</summary>

> Holtpont fog kialakulni, mivel a *serializable* izolációs szint miatt mindkét tranzakció megtiltja a megrendeléstétel tábla módosítását. A `select sum` miatt, és a megismételhető olvasás elvárás miatt a rekordokat olvasó zárral látja el a rendszer. Viszont így nem futhat le a másik tranzakcióban az `insert`, amely kizárólagos zárat igényelne. Ez mindkét tranzakció esetén azt jelenti, hogy a másik által fogott zárra vár.
>
> A holtpont eredménye, hogy az egyik tranzakciót le fogja állítani a szerver. Ez elvárt és helyes működést eredményez, mivel megakadályozza, hogy a két tranzakció közt adat egymásrahatás legyen (így nem fordulhat elő, hogy több terméket adunk el, mint amennyi van).

</details>

<p><br /></p>
<p>Ismételjük meg a fenti műveletsort, csak a megrendelés rögzítésekor más-más termék ID-t használjunk! Ezzel azt szimuláljuk, hogy két megrendelő más-más terméket rendel meg.</p>
<ul>
<li>A feladat megkezdése előtt először is szakítsuk meg a félbemaradt tranzakciókat. Mindkét ablakban adjunk ki pár <code>rollback</code> utasítást az esetleg ottmaradt tranzakciók leállításához.</li>
<li>Ahol utasításban <code>ID</code> vagy <code>ProductID</code> szerepel, ott egyik tranzakcióban a 2-es, másikban a 3-as terméket használjuk.</li>
</ul>
<h4 id="mit-tapasztalt-miert_4">Mit tapasztalt? Miért?<a class="headerlink" href="#mit-tapasztalt-miert_4" title="Permanent link">&para;</a></h4>
<details><summary markdown="span">Magyarázat</summary>

> Ha különböző termékre történik a rögzítés, akkor is holtpont fog kialakulni. Olyan a zárolási rendszer, hogy a `select sum` az egész táblát zárolja, mivel nem tudja megkülönböztetni `ProductID` szerint a rekordokat. Ez természetes is, mivel csak az üzleti logikából adódik, hogy ha két különböző termékre történik a megrendelés rögzítése, akkor azok történhetnének egyszerre is. Az adatbázis ezt nem tudhatja.
>
> Azaz a *serializable* izolációs szint túl szigorú, üzleti logikát figyelembe véve nagyobb párhuzamosítás engedhető meg. Ezért is ritkán használjuk a gyakorlatban.

</details>

<h2 id="feladat-6-megrendeles-rogzitese-read-committed-izolacios-szinten">Feladat 6: Megrendelés rögzítése <em>read committed</em> izolációs szinten<a class="headerlink" href="#feladat-6-megrendeles-rogzitese-read-committed-izolacios-szinten" title="Permanent link">&para;</a></h2>
<p>Gondoljuk végig, az előző feladat esetén mi történne, ha a nem állítjuk át a tranzakciók izolációs szintjét? Lenne holtpont? És helyes lenne a működés?</p>
<h4 id="mit-tapasztalt-miert_5">Mit tapasztalt? Miért?<a class="headerlink" href="#mit-tapasztalt-miert_5" title="Permanent link">&para;</a></h4>
<details><summary markdown="span">Magyarázat</summary>

> Ha nem változtatunk izolációs szintet, akkor helytelen működés állhatna elő. Mivel a *read committed* izolációs szint nem biztosítja számunkra azt, hogy amíg fut a tranzakciónk, addig egy másik tranzakció berögzítsen rekordokat. Tehát lefuthatna az `insert`, ami miatt végeredményben több árut adnánk el, mint ami a raktárban van. Ez a nem megismételhető olvasás problémája.
>
> Erről az oldalról nézve tehát a *serializable* izolációs szint nem volt feleslegesen szigorú. Tényleg megvédett minket egy problémától.

</details>

<h2 id="feladat-7-manualis-zarolas">Feladat 7: Manuális zárolás<a class="headerlink" href="#feladat-7-manualis-zarolas" title="Permanent link">&para;</a></h2>
<p>A feladat megkezdése előtt először is szakítsuk meg a félbemaradt tranzakciókat. Mindkét ablakban adjunk ki pár <code>rollback</code> utasítást az esetleg ottmaradt tranzakciók leállításához.</p>
<p>Read committed izolációs szintet használva dolgozzon ki megoldást, amely csak az <em>azonos termékekre</em> történő párhuzamos adatrögzítéseket akadályozza meg. Természetesen feltételezheti hogy mindegyik párhuzamos folyamat ugyanazt a programlogikát követi.</p>
<p>A megoldáshoz kihasználjuk, hogy lehetséges manuálisan zárakat elhelyezni. Ezek a zárak is, úgy, mint a többi zár, a tranzakció végéig élnek.</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="n">tablename</span> <span class="k">with</span><span class="p">(</span><span class="n">XLOCK</span><span class="p">)</span>
<span class="p">...</span>
</code></pre></div>

<h4 id="hova-kell-ezt-a-zarat-elhelyezni-hogyan-nez-ki-igy-a-megrendeles-folyamata">Hova kell ezt a zárat elhelyezni? Hogyan néz ki így a megrendelés folyamata?<a class="headerlink" href="#hova-kell-ezt-a-zarat-elhelyezni-hogyan-nez-ki-igy-a-megrendeles-folyamata" title="Permanent link">&para;</a></h4>
<details><summary markdown="span">Magyarázat</summary>

> A megoldás kulcsa, hogy jó helyre tegyük a zárat. A kérdés, hogy mit is kellene zárolni? A válasz, hogy a **terméket (Product)**: azt akarjuk meggátolni, hogy ugyanabból a termékből rögzíthető legyen még egy eladás. Tehát a termékre, konkrétan a termék táblában arra a sorra tesszük a zárat, ami a terméket reprezentálja.
>
> Ennek a megoldásnak a hátránya, hogy nagyon alaposan át kell gondolnunk, hogyan és hol végezzük a zárolást.
>
> A lépéseink tehát a következők.

1. **T1 tranzakció**

   <div class="highlight"><pre><span></span><code><span class="k">set</span> <span class="n">transaction</span> <span class="k">isolation</span> <span class="k">level</span> <span class="o">***</span><span class="k">read</span> <span class="k">committed</span><span class="o">***</span>
<span class="k">begin</span> <span class="n">tran</span>

<span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="n">Product</span> <span class="o">***</span><span class="k">with</span> <span class="p">(</span><span class="n">xlock</span><span class="p">)</span><span class="o">***</span>
<span class="k">where</span> <span class="n">ID</span><span class="o">=</span><span class="mi">2</span>
</code></pre></div>

1. **T2 tranzakció**

   <div class="highlight"><pre><span></span><code><span class="k">set</span> <span class="n">transaction</span> <span class="k">isolation</span> <span class="k">level</span> <span class="o">***</span><span class="k">read</span> <span class="k">committed</span><span class="o">***</span>
<span class="k">begin</span> <span class="n">tran</span>

<span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="n">Product</span> <span class="o">***</span><span class="k">with</span> <span class="p">(</span><span class="n">xlock</span><span class="p">)</span><span class="o">***</span>
<span class="k">where</span> <span class="n">ID</span><span class="o">=***</span><span class="mi">3</span><span class="o">***</span>
</code></pre></div>

1. **T1 tranzakció**

   <div class="highlight"><pre><span></span><code><span class="k">select</span> <span class="k">sum</span><span class="p">(</span><span class="n">Amount</span><span class="p">)</span>
<span class="k">from</span> <span class="n">OrderItem</span>
<span class="k">where</span> <span class="n">ProductID</span><span class="o">=</span><span class="mi">2</span>
<span class="k">and</span> <span class="n">StatusID</span><span class="o">=</span><span class="mi">1</span>
</code></pre></div>

1. **T2 tranzakció**

   <div class="highlight"><pre><span></span><code><span class="k">select</span> <span class="k">sum</span><span class="p">(</span><span class="n">Amount</span><span class="p">)</span>
<span class="k">from</span> <span class="n">OrderItem</span>
<span class="k">where</span> <span class="n">ProductID</span><span class="o">=***</span><span class="mi">3</span><span class="o">***</span>
<span class="k">and</span> <span class="n">StatusID</span><span class="o">=</span><span class="mi">1</span>
</code></pre></div>

1. **T1 tranzakció**

   <div class="highlight"><pre><span></span><code><span class="k">insert</span> <span class="k">into</span> <span class="n">OrderItem</span><span class="p">(</span><span class="n">OrderID</span><span class="p">,</span><span class="n">ProductID</span><span class="p">,</span><span class="n">Amount</span><span class="p">,</span><span class="n">StatusID</span><span class="p">)</span>
<span class="k">values</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

1. **T2 tranzakció**

   <div class="highlight"><pre><span></span><code><span class="k">insert</span> <span class="k">into</span> <span class="n">OrderItem</span><span class="p">(</span><span class="n">OrderID</span><span class="p">,</span><span class="n">ProductID</span><span class="p">,</span><span class="n">Amount</span><span class="p">,</span><span class="n">StatusID</span><span class="p">)</span>
<span class="k">values</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="o">***</span><span class="mi">3</span><span class="o">***</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

1. **T1 tranzakció**

   <div class="highlight"><pre><span></span><code><span class="k">commit</span>
</code></pre></div>

1. **T2 tranzakció**

   <div class="highlight"><pre><span></span><code><span class="k">commit</span>
</code></pre></div>

</details>

<h2 id="feladat-8-tabla-szintu-zarolas">Feladat 8: Tábla szintű zárolás<a class="headerlink" href="#feladat-8-tabla-szintu-zarolas" title="Permanent link">&para;</a></h2>
<p>A sor szintű zárolás mellett lehetőségünk van tábla szinten is zárolni:</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="n">tablanev</span> <span class="k">with</span><span class="p">(</span><span class="n">TABLOCKX</span><span class="p">)</span>
<span class="p">...</span>
</code></pre></div>

<h4 id="bar-ez-egyszeru-megoldasnak-tunik-gondoljuk-vegig-miert-nem-erdemes-ezt-hasznalni">Bár ez egyszerű megoldásnak tűnik, gondoljuk végig, miért nem érdemes ezt használni!<a class="headerlink" href="#bar-ez-egyszeru-megoldasnak-tunik-gondoljuk-vegig-miert-nem-erdemes-ezt-hasznalni" title="Permanent link">&para;</a></h4>
<details><summary markdown="span">Magyarázat</summary>

> Jelen esetben a tábla szintű zárat a megrendelésekre kellene tennünk, hiszen a konkurens megrendeléseket akarjuk megakadályozni. De ez ugyanazzal az eredménnyel járna, mint a *serializable* izolációs szint használata. Ugyan holtpont nem lenne, de a párhuzamos végrehajtást lehetetlenné tenné. Tehát a tábla szintű zárolásra ugyanaz igaz: az üzleti logikából nagyobb párhuzamosság adódik.

</details>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        

<!-- Application footer -->
<footer class="md-footer">

  <!-- Link to previous and/or next page -->
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">

      <!-- Copyright and theme information -->
      <div class="md-footer-copyright">
        
        <div class="md-footer-copyright__highlight">
          Copyright &copy; BME AUT
        </div>
        
      </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../assets/javascripts/bundle.b39636ac.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "M\u00e1sol\u00e1s v\u00e1g\u00f3lapra", "clipboard.copied": "V\u00e1g\u00f3lapra m\u00e1solva", "search.config.lang": "hu", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Keres\u00e9shez \u00edrj ide valamit", "search.result.none": "Nincs tal\u00e1lat", "search.result.one": "1 egyez\u0151 dokumentum", "search.result.other": "# egyez\u0151 dokumentum"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.a68abb33.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>